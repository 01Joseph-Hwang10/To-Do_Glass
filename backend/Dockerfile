FROM python:3
ENV PYTHONUNBUFFERED 1

ARG DJANGO_ALLOWED_HOSTS
ARG SECRET_KEY
ARG DJANGO_CORS_ORIGIN_WHITELIST
ARG BACKEND_ADMIN

ENV DJANGO_ALLOWED_HOSTS $DJANGO_ALLOWED_HOSTS
ENV SECRET_KEY $SECRET_KEY
ENV DJANGO_CORS_ORIGIN_WHITELIST $DJANGO_CORS_ORIGIN_WHITELIST
ENV BACKEND_ADMIN $BACKEND_ADMIN

RUN mkdir /backend
WORKDIR /backend
RUN cd backend
RUN pip3 install pipenv
COPY . /backend/
RUN pipenv install
RUN python manage.py makemigrations
RUN python manage.py migrate
